{{/* Hugo轮播图片Shortcode，适配PC/移动端，支持触摸滑动、自动播放 */}}
{{- $imageslist := .Get "imageslist" | default "" | split "," -}} {{/* 图片地址，逗号分隔 */}}
{{- $titles := .Get "titles" | default "" | split "," -}} {{/* 图片标题，逗号分隔（可选） */}}
{{- $autoplay := .Get "autoplay" | default "true" -}} {{/* 是否自动播放，默认true */}}
{{- $interval := .Get "interval" | default "5000" | int -}} {{/* 轮播间隔，默认5000ms */}}
{{- $height := .Get "height" | default "400px" -}} {{/* 轮播容器高度，默认400px */}}

{{/* 校验图片是否传入 */}}
{{- if eq (len $imageslist) 0 -}}
  <div style="padding: 2rem; text-align: center; color: #666; border: 1px dashed #ddd;">
    轮播图使用错误：请通过 images 参数传入图片地址，多个地址用英文逗号分隔
  </div>
  {{- return -}}
{{- end -}}

{{$imageslist}}
{{/* 轮播容器：唯一ID（防止多个轮播冲突）+ 样式 */}}
<div class="hugo-carousel" id="hugo-carousel-{{ md5 .Page.File.Path }}" style="--carousel-height: {{ $height }}; --autoplay-interval: {{ $interval }}ms;" {{ if eq $autoplay "false" }}data-autoplay="false"{{ end }}>
  {{/* 轮播图片容器 */}}
  <div class="hugo-carousel-slides">
    {{- range $index, $img := $imageslist -}}
      {{- $title := index $titles $index | default "" -}}
      <div class="hugo-carousel-slide">
        <img 
          src="{{ $img }}" 
          alt="{{ $title | default (print "轮播图" (add $index 1)) }}"
          loading="lazy" {{/* 懒加载，优化性能 */}}
        >
        234
        {{- if $title -}}
          <div class="hugo-carousel-caption">132{{ $title }}</div>
        {{- end -}}
      </div>
    {{- end -}}
  </div>

  {{/* 左右切换按钮 */}}
  <button class="hugo-carousel-prev">&lt;</button>
  <button class="hugo-carousel-next">&gt;</button>

  {{/* 轮播指示器（小圆点） */}}
  <div class="hugo-carousel-indicators">
    {{- range $index, $ := $imageslist -}}
      <button {{ if eq $index 0 }}class="active"{{ end }} data-index="{{ $index }}"></button>
    {{- end -}}
  </div>
</div>

{{/* 轮播核心样式：内联样式，无需额外引入CSS，适配PC/移动端 */}}
<style>
  .hugo-carousel {
    position: relative;
    width: 100%;
    height: var(--carousel-height);
    max-width: 1200px; {{/* PC端最大宽度，可自行调整 */}}
    margin: 0 auto;
    overflow: hidden;
    border-radius: 8px; {{/* 圆角，可选 */}}
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); {{/* 轻微阴影，提升视觉 */}}
  }
  .hugo-carousel-slides {
    position: relative;
    width: 100%;
    height: 100%;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .hugo-carousel-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    z-index: 1;
  }
  .hugo-carousel-slide.active {
    opacity: 1;
    z-index: 2;
  }
  .hugo-carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover; {{/* 保持图片比例，裁剪多余部分，可选contain（完整显示） */}}
  }
  .hugo-carousel-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 1rem;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    color: #fff;
    font-size: 1rem;
    box-sizing: border-box;
  }
  /* 切换按钮样式 */
  .hugo-carousel-prev, .hugo-carousel-next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3;
    padding: 0.8rem 1rem;
    background: rgba(0,0,0,0.3);
    color: #fff;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    transition: background 0.3s;
  }
  .hugo-carousel-prev { left: 15px; }
  .hugo-carousel-next { right: 15px; }
  .hugo-carousel-prev:hover, .hugo-carousel-next:hover { background: rgba(0,0,0,0.6); }
  /* 指示器样式 */
  .hugo-carousel-indicators {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 3;
    display: flex;
    gap: 8px;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  .hugo-carousel-indicators button {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    border: none;
    cursor: pointer;
    transition: background 0.3s;
  }
  .hugo-carousel-indicators button.active {
    background: #fff;
    width: 25px;
    border-radius: 5px; {{/* 激活的指示器变长条，更醒目 */}}
  }
  /* 移动端适配：缩小按钮、调整字体、适配触摸 */
  @media (max-width: 768px) {
    .hugo-carousel {
      --carousel-height: 250px; {{/* 移动端默认高度，可覆盖 */}}
      border-radius: 4px;
    }
    .hugo-carousel-prev, .hugo-carousel-next {
      padding: 0.5rem 0.7rem;
      font-size: 1rem;
    }
    .hugo-carousel-caption {
      font-size: 0.85rem;
      padding: 0.7rem;
    }
    .hugo-carousel-indicators button {
      width: 8px;
      height: 8px;
    }
    .hugo-carousel-indicators button.active {
      width: 20px;
    }
  }
  /* 超小屏（手机竖屏） */
  @media (max-width: 480px) {
    .hugo-carousel {
      --carousel-height: 200px;
    }
  }
</style>

{{/* 轮播核心JS：自动播放、切换、指示器、触摸滑动、悬浮暂停 */}}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('hugo-carousel-{{ md5 .Page.File.Path }}');
    if (!carousel) return;
    const slides = carousel.querySelectorAll('.hugo-carousel-slide');
    const prevBtn = carousel.querySelector('.hugo-carousel-prev');
    const nextBtn = carousel.querySelector('.hugo-carousel-next');
    const indicators = carousel.querySelectorAll('.hugo-carousel-indicators button');
    const autoplay = carousel.dataset.autoplay !== 'false';
    const interval = parseInt(getComputedStyle(carousel).getPropertyValue('--autoplay-interval'));
    let currentIndex = 0;
    let autoplayTimer = null;

    // 切换到指定索引的轮播图
    const goToSlide = (index) => {
      // 边界处理
      if (index < 0) index = slides.length - 1;
      if (index >= slides.length) index = 0;
      // 移除所有激活状态
      slides.forEach(s => s.classList.remove('active'));
      indicators.forEach(i => i.classList.remove('active'));
      // 添加当前激活状态
      slides[index].classList.add('active');
      indicators[index].classList.add('active');
      currentIndex = index;
    };

    // 下一张/上一张
    const nextSlide = () => goToSlide(currentIndex + 1);
    const prevSlide = () => goToSlide(currentIndex - 1);

    // 绑定按钮事件
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);
    // 绑定指示器事件
    indicators.forEach(btn => {
      btn.addEventListener('click', () => goToSlide(parseInt(btn.dataset.index)));
    });

    // 自动播放函数
    const startAutoplay = () => {
      if (!autoplay) return;
      autoplayTimer = setInterval(nextSlide, interval);
    };
    // 暂停自动播放
    const stopAutoplay = () => clearInterval(autoplayTimer);

    // 悬浮暂停自动播放，离开继续
    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);

    // 移动端触摸滑动：支持左右滑切换
    let touchStartX = 0;
    let touchEndX = 0;
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      stopAutoplay(); // 触摸时暂停播放
    });
    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].clientX;
      const touchDiff = touchStartX - touchEndX;
      // 滑动距离阈值（避免误触）
      if (touchDiff > 50) nextSlide(); // 左滑→下一张
      if (touchDiff < -50) prevSlide(); // 右滑→上一张
      startAutoplay(); // 触摸结束继续播放
    });

    // 初始化：启动自动播放、显示第一张
    startAutoplay();
  });
</script>